/**
 * Type definitions for Vulnerability Hunter
 */

export interface VulnerabilityDiscovery {
  id: string;
  discoveredAt: number;
  source: DiscoverySource;
  target: TargetInfo;
  vulnerability: VulnerabilityInfo;
  analysis: AnalysisResult;
  bounty?: BountyInfo;
  status: 'discovered' | 'analyzing' | 'verified' | 'false_positive' | 'submitted' | 'disclosed';
}

export interface DiscoverySource {
  platform: 'twitter' | 'reddit' | 'github' | 'linkedin' | 'news' | 'blog';
  url: string;
  author: string;
  authorProfile?: string;
  content: string;
  timestamp: number;
  credibilityScore: number; // 0-100
}

export interface TargetInfo {
  repository?: string;
  website?: string;
  organization?: string;
  language?: string;
  category: 'web' | 'mobile' | 'smart-contract' | 'api' | 'infrastructure' | 'other';
  techStack?: string[];
}

export interface VulnerabilityInfo {
  type: VulnerabilityType;
  severity: 'critical' | 'high' | 'medium' | 'low' | 'info';
  cvss?: number;
  cve?: string;
  description: string;
  affectedCode?: string;
  affectedVersions?: string[];
  exploit?: string;
  remediation: string;
}

export type VulnerabilityType =
  | 'sql_injection'
  | 'xss'
  | 'csrf'
  | 'rce'
  | 'ssrf'
  | 'auth_bypass'
  | 'idor'
  | 'lfi'
  | 'rfi'
  | 'xxe'
  | 'deserialization'
  | 'reentrancy'
  | 'integer_overflow'
  | 'access_control'
  | 'cryptographic'
  | 'dos'
  | 'info_disclosure'
  | 'other';

export interface AnalysisResult {
  factCheckVerdict: 'verified' | 'unverified' | 'false';
  factCheckConfidence: number;
  repositoryAnalysis?: RepositoryAnalysis;
  threatModel?: ThreatModel;
  staticAnalysis?: StaticAnalysisResult;
  aiAnalysis?: AIAnalysisResult;
}

export interface RepositoryAnalysis {
  cloned: boolean;
  path?: string;
  readme?: string;
  documentation?: string[];
  dependencies: Dependency[];
  vulnerableDependencies: VulnerableDependency[];
  fileCount: number;
  linesOfCode: number;
  languages: Record<string, number>; // language -> percentage
}

export interface Dependency {
  name: string;
  version: string;
  type: 'runtime' | 'dev';
}

export interface VulnerableDependency extends Dependency {
  cve: string;
  severity: string;
  fixedIn?: string;
}

export interface ThreatModel {
  attackSurface: AttackSurface[];
  dataFlows: DataFlow[];
  strideThreats: StrideAnalysis;
  riskScore: number; // 0-100
}

export interface AttackSurface {
  component: string;
  exposureLevel: 'public' | 'authenticated' | 'internal';
  threats: string[];
}

export interface DataFlow {
  source: string;
  destination: string;
  dataType: string;
  encrypted: boolean;
  validated: boolean;
}

export interface StrideAnalysis {
  spoofing: Threat[];
  tampering: Threat[];
  repudiation: Threat[];
  informationDisclosure: Threat[];
  denialOfService: Threat[];
  elevationOfPrivilege: Threat[];
}

export interface Threat {
  description: string;
  likelihood: 'low' | 'medium' | 'high';
  impact: 'low' | 'medium' | 'high';
  mitigation: string;
}

export interface StaticAnalysisResult {
  tool: string;
  findings: Finding[];
  executionTime: number;
}

export interface Finding {
  type: string;
  severity: 'critical' | 'high' | 'medium' | 'low' | 'info';
  file: string;
  line: number;
  code: string;
  description: string;
  recommendation: string;
}

export interface AIAnalysisResult {
  model: string;
  summary: string;
  vulnerabilities: AIVulnerability[];
  exploitability: number; // 0-100
  recommendations: string[];
  generatedExploit?: string;
}

export interface AIVulnerability {
  type: string;
  location: string;
  description: string;
  severity: string;
  confidence: number; // 0-100
}

export interface BountyInfo {
  platform: 'hackerone' | 'bugcrowd' | 'synack' | 'intigriti' | 'yeswehack' | 'direct';
  programName?: string;
  estimatedReward?: string;
  submitted: boolean;
  submissionId?: string;
  submittedAt?: number;
  response?: string;
  paidOut?: number;
}

// ============================================================================
// Social Media Types
// ============================================================================

export interface TwitterSearchResult {
  tweets: Tweet[];
  nextToken?: string;
}

export interface Tweet {
  id: string;
  text: string;
  author: string;
  authorId: string;
  createdAt: string;
  url: string;
  metrics: {
    likes: number;
    retweets: number;
    replies: number;
  };
}

export interface RedditPost {
  id: string;
  title: string;
  selftext: string;
  author: string;
  subreddit: string;
  url: string;
  createdAt: number;
  score: number;
}

export interface GitHubIssue {
  id: number;
  title: string;
  body: string;
  author: string;
  repositoryUrl: string;
  url: string;
  createdAt: string;
  state: 'open' | 'closed';
  labels: string[];
}

// ============================================================================
// Search & Monitoring
// ============================================================================

export interface MonitorConfig {
  platforms: Platform[];
  keywords: string[];
  intervalMinutes: number;
  maxResults: number;
  filters?: SearchFilters;
}

export type Platform = 'twitter' | 'reddit' | 'github' | 'linkedin' | 'news';

export interface SearchFilters {
  minCredibility?: number;
  languages?: string[];
  categories?: string[];
  severityMin?: 'low' | 'medium' | 'high' | 'critical';
  excludeKeywords?: string[];
}

export interface MonitorResult {
  platform: Platform;
  results: (Tweet | RedditPost | GitHubIssue)[];
  timestamp: number;
  nextCursor?: string;
}

// ============================================================================
// Pipeline Configuration
// ============================================================================

export interface PipelineConfig {
  monitoring: MonitorConfig;
  factChecking: {
    enabled: boolean;
    minConfidence: number;
  };
  repositoryAnalysis: {
    enabled: boolean;
    cloneRepos: boolean;
    maxRepoSize: number; // MB
    runStaticAnalysis: boolean;
  };
  threatModeling: {
    enabled: boolean;
    useAI: boolean;
  };
  bugDiscovery: {
    enabled: boolean;
    aiModel: 'gpt-4' | 'claude-opus' | 'claude-sonnet';
    generateExploits: boolean;
  };
  reporting: {
    autoSubmitBounty: boolean;
    notificationChannels: ('email' | 'slack' | 'discord')[];
  };
}
